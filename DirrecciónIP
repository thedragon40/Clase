@echo off

set /p IP="Ingrese la dirección IP base: "
set /p Subredes="Ingrese el número de subredes: "

set /a BitsRed=24 
set /a Hosts=28

setlocal EnableDelayedExpansion

set /a BitsSubred=32-%BitsRed%
set /a NumHosts=2^%BitsSubred%-2

set /a TotHosts=%NumHosts% * %Subredes%

if %TotHosts% GTR 254 (
  echo No hay suficientes hosts disponibles
  goto :FIN
)

set /a IP_Inicial=IP

for /L %%i in (1,1,%Subredes%) do (

  set /a Red=IP_Inicial
  set /a Red=Red>>BitsRed
  set /a Red=Red<<BitsRed
  
  set /a Broad=Red+NumHosts
  set /a PriIP=Red+1
  set /a UltIP=Broad-1
  
  set /a TotIPs=NumHosts+2
  
  echo Subred %%i
  echo ========
  echo IP de red:        !Red!
  echo IP Primera:       !PriIP! 
  echo IP Ultima:        !UltIP!
  echo IP Broadcast:     !Broad!
  
  set /a IP_Inicial+=NumHosts+2
  
)

:FIN

pause
